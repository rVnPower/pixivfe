# Localization

Notes on i18n/

## Todo

- [ ] Add env PIXIVFE_SERVER_LOCALE and set `i18n.GlobalLocale` to that on startup
- [ ] Rewrite jet template on load to use translated strings
- [ ] Check if any jet template strings are ignored (false negative)
- Setup Crowdin
  - [x] manual upload and download
  - [x] automatic upload and download

## Crowdin CLI usage

Install the CLI: [See official instructions](https://crowdin.github.io/crowdin-cli/installation)

Remember to check `crowdin -V`. Should be `4.2.0` or later.

First, setup API token:

1. Go to https://crowdin.com/settings#api-key
2. Click the "New Token" button
3. Set permission: Projects >
  - Projects (List, Get, Create, Edit) -- Read only
  - Source files & strings (List, Get, Create, Edit) -- Read and write
  - Translations (List, Get, Create, Edit) -- Read and write
4. Copy the new token and save it somewhere

Then, try it out.

```shell
export CROWDIN_PERSONAL_TOKEN=token_here # put this somewhere in your shell config
crowdin upload
crowdin download
```

## Crowdin Web UI usage

Add new languages to translate in Settings > Languages.

## ./i18n/crawler -- Primer on html and jet's treatment of templates

```
<a>abc {{.Hi}}</a>
```

html: `abc {{.Hi}}` is text

jet: `<a>abc ` is text
jet: `</a>` is text

So, jet doesn't care about HTML.

And we have to care about `{* *}` comments.

## ./i18n/crawler -- Coalesce inline tags

Example: in below, the `<a>` tag should be part of the string.

```html
Log in with your Pixiv account's cookie to access features above. To learn how to obtain your cookie, please see <a href="https://pixivfe-docs.pages.dev/obtaining-pixivfe-token/">the guide on obtaining your PixivFE token</a>.
```

Tags to consider as inline: `a`
