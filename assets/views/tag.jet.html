{{- extends "layout/default" }}
{{- import "blocks/switcher" }}
{{- block body() }}

<div class="container-fluid">
  <div class="card mt-4">
    <div class="card-body">
      <div class="row">
        {{- if .Tag.Metadata.ID }}
        <div class="col-md-3">
          <a href="/artworks/{{ .Tag.Metadata.ID }}">
            <img class="img-fluid rounded" src="{{ .Tag.Metadata.Image }}" alt="{{ .Tag.Name }}" />
          </a>
        </div>
        {{- end }}
        <div class="col-md-9">
          <h1 class="card-title">#{{ .Tag.Name }}</h1>
          <h4 class="card-subtitle mb-2 text-muted">{{ .Tag.Metadata.Name }}</h4>
          <p class="card-text"><strong>{{ .Data.Artworks.Total }}</strong> works</p>
          <p class="card-text">{{ .Tag.Metadata.Detail }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <h5>Related Tags</h5>
    <div class="list-group list-group-horizontal flex-wrap">
      {{- range .Data.RelatedTags }}
      <a href="/tags/{{ . }}" class="list-group-item list-group-item-action">#{{ . }}</a>
      {{- end }}
    </div>
  </div>

  {{- Category := isset(.Queries.category) ? .Queries.category : "artworks" }}
  {{- Order := isset(.Queries.order) ? .Queries.order : "date_d" }}
  {{- Mode := isset(.Queries.mode) ? .Queries.mode : "safe" }}
  {{- Ratio := isset(.Queries.ratio) ? .Queries.ratio : "" }}
  {{- SearchMode := isset(.Queries.smode) ? .Queries.smode : "" }}

  <div class="mt-4">
    <h5>Filters</h5>
    <ul class="nav nav-pills">
      <li class="nav-item">
        <span class="nav-link">Category</span>
        {{- URL := unfinishedQuery(.QueriesC, "category") }}
        {{- path := slice("artworks", "illustrations", "manga")}}
        {{- name := slice("Artworks", "Illustrations", "Manga")}}
        {{- yield Switcher(baseURL=URL, paths=path, names=name, currentPath=Category) }}
      </li>
      <li class="nav-item">
        <span class="nav-link">Order</span>
        {{- URL := unfinishedQuery(.QueriesC, "order") }}
        {{- path := slice("date_d", "date")}}
        {{- name := slice("Newest", "Oldest")}}
        {{- yield Switcher(baseURL=URL, paths=path, names=name, currentPath=Order) }}
      </li>
      <li class="nav-item">
        <span class="nav-link">Filter</span>
        {{- URL := unfinishedQuery(.QueriesC, "mode") }}
        {{- path := slice("all", "safe", "r18")}}
        {{- name := slice("All", "Safe", "R-18")}}
        {{- yield Switcher(baseURL=URL, paths=path, names=name, currentPath=Mode) }}
      </li>
      <li class="nav-item">
        <span class="nav-link">Ratio</span>
        {{- URL := unfinishedQuery(.QueriesC, "ratio") }}
        {{- path := slice("", "-0.5", "0", "0.5")}}
        {{- name := slice("All", "Portrait", "Square", "Landscape")}}
        {{- yield Switcher(baseURL=URL, paths=path, names=name, currentPath=Ratio) }}
      </li>
      <li class="nav-item">
        <span class="nav-link">Search mode</span>
        {{- URL := unfinishedQuery(.QueriesC, "smode") }}
        {{- path := slice("", "s_tag_full", "s_tag", "s_tc")}}
        {{- name := slice("None", "Exact (tags)", "Partial (tags)", "Title/Caption")}}
        {{- yield Switcher(baseURL=URL, paths=path, names=name, currentPath=SearchMode) }}
      </li>
    </ul>
  </div>

  <div class="accordion mt-4" id="advancedSettings">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingAdvanced">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdvanced" aria-expanded="false" aria-controls="collapseAdvanced">
          Advanced settings
        </button>
      </h2>
      <div id="collapseAdvanced" class="accordion-collapse collapse" aria-labelledby="headingAdvanced" data-bs-parent="#advancedSettings">
        <div class="accordion-body">
          {{- URL := unfinishedQuery(.QueriesC, "") }}
          <form action="{{ URL }}&name={{ .QueriesC.Query[" Name"] }}" method="post" class="row g-3">
            <div class="col-md-6">
              <label for="wlt" class="form-label">Minimum image width</label>
              <input type="text" class="form-control" id="wlt" name="wlt" value="{{ .QueriesC.Query[" Wlt"] }}" />
            </div>
            <div class="col-md-6">
              <label for="wgt" class="form-label">Maximum image width</label>
              <input type="text" class="form-control" id="wgt" name="wgt" value="{{ .QueriesC.Query[" Wgt"] }}" />
            </div>
            <div class="col-md-6">
              <label for="hlt" class="form-label">Minimum image height</label>
              <input type="text" class="form-control" id="hlt" name="hlt" value="{{ .QueriesC.Query[" Hlt"] }}" />
            </div>
            <div class="col-md-6">
              <label for="hgt" class="form-label">Maximum image height</label>
              <input type="text" class="form-control" id="hgt" name="hgt" value="{{ .QueriesC.Query[" Hgt"] }}" />
            </div>
            <div class="col-md-6">
              <label for="scd" class="form-label">Posted after (format: yyyy-mm-dd)</label>
              <input type="text" class="form-control" id="scd" name="scd" value="{{ .QueriesC.Query[" Scd"] }}" />
            </div>
            <div class="col-md-6">
              <label for="ecd" class="form-label">Posted before (format: yyyy-mm-dd)</label>
              <input type="text" class="form-control" id="ecd" name="ecd" value="{{ .QueriesC.Query[" Ecd"] }}" />
            </div>
            <div class="col-md-6">
              <label for="tool" class="form-label">Tool</label>
              <input type="text" class="form-control" id="tool" name="tool" value="{{ .QueriesC.Query[" Tool"] }}" />
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Set</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  {{- if .Data.Popular.Recent }}
  <h2 class="mt-4">Popular artworks</h2>
  <h3 class="mt-3">Recent</h3>
  <div class="row row-cols-1 row-cols-md-4 g-4">
    {{- include "fragments/small-tn" .Data.Popular.Recent }}
  </div>
  <h3 class="mt-3">All Time</h3>
  <div class="row row-cols-1 row-cols-md-4 g-4">
    {{- include "fragments/small-tn" .Data.Popular.Permanent }}
  </div>
  {{- end }}

  <h2 class="mt-4">Works</h2>
  <div class="row row-cols-1 row-cols-md-4 g-4">
    {{- include "fragments/small-tn" .Data.Artworks.Artworks }}
  </div>

  <nav class="mt-4" aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      {{- url := unfinishedQuery(.QueriesC, "page") }}
      <li class="page-item disabled">
        <span class="page-link">Page {{ .Page }}</span>
      </li>
      {{- raw: createPaginator(url, "#checkpoint", .Page, -1) }}
    </ul>
  </nav>
</div>
{{- end }}
